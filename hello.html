<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>signup - blendify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="/styles/userStyle/style1.css" />
    <style>
      .error-message {
        color: red;
        font-size: smaller;
      }
      .form-control {
        font-size: medium;
        border: none !important;
        padding: 0 !important;
        border-bottom: 1px solid #000000 !important;
      }
      input::placeholder {
        color: rgb(118, 118, 118) !important; /* Set placeholder text color */
      }

      .acc:hover {
        color: rgba(139, 0, 0) !important ;
        text-decoration: underline;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
  </head>

  <body>
    <div class="wrapper">
      <div class="inner">
        <div class="image-holder">
          <img
            src="/images/userImg/home/img1.jpg"
            alt=""
            width="405"
            height="530"
          />
        </div>
        <form action="/signup" method="post" id="signform" novalidate>
          <h3>Sign Up to Start Blending</h3>
          <%if(locals.message && message.length>0){%>
          <div class="alert alert-danger" role="alert"><%=message%></div>
          <%}%>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="text"
              placeholder="Full Name"
              class="form-control"
              id="name"
              name="name"
              required=""
              autocomplete="off"
            />
            <i id="error1" class="error-message"></i>
          </div>

          <div></div>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="text"
              placeholder="Email Address"
              class="form-control"
              id="email"
              name="email"
              required=""
              autocomplete="off"
            />
            <i id="error2" class="error-message"></i>
          </div>

          <div></div>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="text"
              placeholder="Phone Number"
              class="form-control"
              id="phone"
              name="phone"
              required=""
              autocomplete="off"
            />
            <i id="error3" class="error-message"></i>
          </div>
          <div></div>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="password"
              placeholder="Password"
              class="form-control"
              id="password"
              required=""
              name="password"
            />
            <i id="error4" class="error-message"></i>
          </div>

          <div></div>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="password"
              placeholder="Confirm Password"
              class="form-control"
              id="confirm-password"
              required=""
              name="cPassword"
            />
            <i id="error5" class="error-message"></i>
          </div>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="text"
              placeholder="Referral code"
              class="form-control"
              id="cReferral"
              name="cReferral"
            />
            <!-- <i id="error5" class="error-message"></i> -->
          </div>

          <button style="margin-top: 6px">Sign Up</button>
          <h6 style="margin: 2px 144px">OR</h6>
          <div class="form-wrapper">
            <a href="/auth/google" class="button" style="text-decoration: none"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-google"
                viewBox="0 0 16 16"
                style="margin: 0px 6px"
              >
                <path
                  d="M15.545 6.558a9.4 9.4 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.7 7.7 0 0 1 5.352 2.082l-2.284 2.284A4.35 4.35 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.8 4.8 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.7 3.7 0 0 0 1.599-2.431H8v-3.08z"
                /></svg
              >Sign Up with Google</a
            >
          </div>

          <a href="/login" style="color: black; font-size: smaller" class="acc"
            >have an account?</a
          >
        </form>
      </div>
    </div>
    <script>
      const nameid = document.getElementById("name");
      const emailid = document.getElementById("email");
      const phoneid = document.getElementById("phone");
      const passid = document.getElementById("password");
      const cpassid = document.getElementById("confirm-password");
      const error1 = document.getElementById("error1");
      const error2 = document.getElementById("error2");
      const error3 = document.getElementById("error3");
      const error4 = document.getElementById("error4");
      const error5 = document.getElementById("error5");
      const signform = document.getElementById("signform");

      function nameValidateChecking() {
        const nameval = nameid.value;
        const namepattern = /^[A-Za-z\s]+$/;
        if (nameval.trim() === "") {
          error1.style.display = "block";
          error1.innerHTML = "Please enter a valid name";
        } else if (!namepattern.test(nameval)) {
          error1.style.display = "block";
          error1.innerHTML = "Name can only contain letters and spaces";
        } else {
          error1.style.display = "none";
          // error1.innerHTML = "";
        }
      }

      function phoneValidateChecking() {
        const phoneval = phoneid.value.trim();
        const phonePattern = /^[0-9]+$/;

        if (phoneval === "") {
          error3.style.display = "block";
          error3.innerHTML = "Enter a valid phone number";
        } else if (!phonePattern.test(phoneval)) {
          error3.style.display = "block";
          error3.innerHTML = "Phone number can only contain digits";
        } else if (phoneval.length !== 10) {
          error3.style.display = "block";
          error3.innerHTML = "Phone number must be 10 digits";
        } else if (phoneval === "0000000000") {
          error3.style.display = "block";
          error3.innerHTML = "Phone number cannot be all zeros";
        } else {
          error3.style.display = "none";
        }
      }

      function emailValidateChecking() {
        const emailVal = emailid.value;
        const emailpattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        if (!emailpattern.test(emailVal)) {
          error2.style.display = "block";
          error2.innerHTML = "Enter a valid email address";
        } else {
          error2.style.display = "none";
          // error2.innerHTML = "";
        }
      }

      function passValidateChecking() {
        const passval = passid.value;
        const cpassval = cpassid.value;
        const alpha = /[a-zA-Z]/;
        const digit = /\d/;
        if (passval.length < 8) {
          error4.style.display = "block";
          error4.innerHTML = "Password must be at least 8 characters";
        } else if (!alpha.test(passval) || !digit.test(passval)) {
          error4.style.display = "block";
          error4.innerHTML = "Password should contain both letters and numbers";
        } else {
          error4.style.display = "none";
          error4.innerHTML = "";
        }
        if (passval !== cpassval) {
          error5.style.display = "block";
          error5.innerHTML = "Passwords do not match";
        } else {
          error5.style.display = "none";
          // error5.innerHTML = "";
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        signform.addEventListener("submit", function (e) {
          nameValidateChecking();
          emailValidateChecking();
          phoneValidateChecking();
          passValidateChecking();
          if (
            error1.innerHTML ||
            error2.innerHTML ||
            error3.innerHTML ||
            error4.innerHTML ||
            error5.innerHTML
          ) {
            e.preventDefault();
          }
        });
      });

      nameid.addEventListener("input", nameValidateChecking);
      emailid.addEventListener("input", emailValidateChecking);
      phoneid.addEventListener("input", phoneValidateChecking);
      passid.addEventListener("input", passValidateChecking);
      cpassid.addEventListener("input", passValidateChecking);
    </script>
  </body>
</html>

<!-- verifyotp.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Blendify" />
    <meta name="keywords" content="Blendify, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Blendify</title>

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />

    <style>
      .wrapper {
        /* position: absolute; */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url(/images/userImg/home/img2_1.png);
        background-size: cover;
        background-position: center;
        /* filter: blur(3px);
    z-index: -10; */
      }
      body,
      html {
        height: 100%;
        margin: 0;
        font-family: "Nunito Sans", sans-serif;
        overflow: hidden;
      }
      .container {
        display: flex;
        /* background-image: url("/images/userImg/home/img2.jpg");  */
        background-position: center;
        justify-content: center;
        align-items: center;
        height: 100%;
      }
      .login_wrap {
        width: 100%;
        max-width: 400px;
        padding: 20px;
        border-radius: 5px;
        background: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .heading_s1 h3 {
        margin: 0;
        font-size: 24px;
        font-weight: 600;
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .form-group {
        margin-bottom: 15px;
        /* margin-left: 15px; */
      }
      .otp-timer {
        display: inline-block;
        margin-left: 10px;
        font-size: 14px;
        position: relative;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        line-height: 60px;
        text-align: center;
        background: #f2f2f2;
        border: 2px solid #ddd;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      #timerValue {
        display: block;
        font-size: 24px;
        font-weight: bold;
        color: #333;
        line-height: 60px;
      }
      #timerValue.expired {
        font-size: 14px;
        color: red;
      }
      .btn-primary {
        background-color: rgba(139, 0, 0);
        border: none;
        color: white;
        height: 33px;
        width: 299px;
        margin: 21px 39px;
        display: block;
      }

      .btn-secondary {
        background-color: #6c757d;
        border: none;
        color: white;
        height: 33px;
        width: 299px;
        margin: 21px 39px;
        display: block;
      }
      .btn-secondary:hover {
        background-color: #5a6268;
      }
      .alert-danger {
        margin-top: 15px;
        text-align: center;
      }
      .text-center {
        text-align: center;
        margin-top: 15px;
      }
      .text-muted {
        color: #6c757d;
        text-align: center;
      }
      .pt-25 {
        padding-top: 25px;
      }
      .container {
        /* background-image: url("/images/userImg/home/img2.jpg");  */
      }
    </style>
  </head>
  <body>
    <div class="container wrapper">
      <div class="login_wrap">
        <div class="padding_eight_all bg-white">
          <div class="heading_s1">
            <h3>Email Verification Page</h3>
          </div>
          <form
            id="otpForm"
            action="/verify-otp"
            method="post"
            onsubmit="return validateOTPForm()"
          >
            <div class="form-group" style="display: inline">
              <label for="otp" style="margin-left: 23px">Enter OTP:</label>
              <input
                style="height: 25px; width: 230px"
                type="text"
                id="otp"
                name="otp"
                class="form-control"
                required
                maxlength="6"
                pattern="\d*"
              />
            </div>
            <button type="submit" class="btn btn-primary">Verify Email</button>
            <div class="form-group text-center">
              <div id="otpTimer" class="otp-timer">
                <span id="timerValue">60</span>
              </div>
              <button
                id="resendOtpBtn"
                type="button"
                class="btn btn-secondary"
                onclick="resendOTP()"
                disabled
              >
                Resend OTP
              </button>
            </div>
            <% if (locals.message && message.length > 0) { %>
            <div class="alert alert-danger"><%= message %></div>
            <% } %>
          </form>
          <div class="text-muted text-center pt-25">
            Already verified?
            <a href="/login" style="color: rgba(139, 0, 0)">Login now</a>
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      document.getElementById("otp").focus();

      let timer = 60;
      let timerInterval;

      function startTimer() {
        timerInterval = setInterval(() => {
          timer--;
          document.getElementById("timerValue").textContent = timer;
          if (timer <= 0) {
            clearInterval(timerInterval);
            document.getElementById("timerValue").classList.add("expired");
            document.getElementById("timerValue").textContent = "Expired";
            document.getElementById("otp").disabled = true;
            document.getElementById("resendOtpBtn").disabled = false;
          }
        }, 1000);
      }

      function validateOTPForm() {
        const otpInput = document.getElementById("otp").value;

        $.ajax({
          type: "POST",
          url: "verify-otp",
          data: { otp: otpInput },
          success: function (response) {
            if (response.success) {
              Swal.fire({
                icon: "success",
                title: "OTP Verifies Successfully",
                showConfirmButton: false,
                timer: 1500,
              }).then(() => {
                window.location.href = response.redirectUrl;
              });
            } else {
              Swal.fire({
                icon: "error",
                title: Error,
                text: response.message,
              });
            }
          },
          error: function () {
            Swal.fire({
              icon: "error",
              title: "Invalid OTP",
              text: "Please try again",
            });
          },
        });

        return false;
      }

      function resendOTP() {
        clearInterval(timerInterval);
        timer = 60;
        document.getElementById("otp").disabled = false;
        document.getElementById("timerValue").classList.remove("expiresd");
        document.getElementById("timerValue").textContent = timer;
        document.getElementById("resendOtpBtn").disabled = true;
        startTimer();

        $.ajax({
          type: "POST",
          url: "resend-otp",
          success: function (response) {
            if (response.success) {
              Swal.fire({
                icon: "success",
                title: "OTP Resend Successfully",
                showConfirmButton: false,
                timer: 1500,
              });
            } else {
              Swal.fire({
                icon: "erroR",
                title: "Error",
                text: "An error occured while resending OTP,Please try again",
              });
            }
          },
        });
        return false;
      }

      startTimer();
    </script>
  </body>
</html>

<!-- login -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Login - blendify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
      integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="/styles/userStyle/style1.css" />
    <style>
      input::placeholder {
        color: rgb(118, 118, 118) !important; /* Set placeholder text color */
      }
      .acc:hover {
        color: rgba(139, 0, 0) !important ;
        text-decoration: underline;
      }
      #pass-icon {
        width: 15px;
        position: relative;
        left: 295px;
        top: -47px;
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <div class="inner">
        <div class="image-holder">
          <img
            src="/images/userImg/home/img1.jpg"
            alt=""
            width="405"
            height="530"
          />
        </div>
        <form id="loginform" method="post" action="/login">
          <h3>Welcome Back! Ready to Blend?</h3>
          <%if(locals.message && message.length>0){%>
          <div class="alert alert-danger" role="alert"><%=message%></div>
          <%}%>
          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="text"
              placeholder="Email Address"
              class="form-control"
              id="email"
              name="email"
              required=""
              autocomplete="off"
            />
            <i class="zmdi zmdi-email"></i>
            <div id="error1" class="error-message"></div>
          </div>

          <div class="form-wrapper">
            <input
              style="border-radius: 0; box-shadow: none; border-color: black"
              type="password"
              placeholder="Password"
              class="form-control"
              id="password"
              required=""
              name="password"
            />
            <i class="zmdi zmdi-lock"></i>
            <img
              src="/images/userImg/icon/closed2.png"
              onclick="togglePassword()"
              alt="Toggle Password Visibility"
              class="pass-icon"
              id="pass-icon"
            />
            <div id="error2" class="error-message"></div>
          </div>

          <div class="form-group d-flex justify-content-end">
            <a
              href="/forgot-password"
              class="forgot-password-link ms-auto"
              style="color: rgba(139, 0, 0); position: relative; top: -16px"
            >
              <i class="fa fa-key"></i> Forgot Password?
            </a>
          </div>
          <button style="margin-top: 15px">
            Login
            <i class="zmdi zmdi-arrow-right"></i>
          </button>
          <h6 style="margin: 2px 144px">OR</h6>
          <div class="form-wrapper">
            <a href="/auth/google" class="button" style="text-decoration: none"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-google"
                viewBox="0 0 16 16"
                style="margin: 0px 6px"
              >
                <path
                  d="M15.545 6.558a9.4 9.4 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.7 7.7 0 0 1 5.352 2.082l-2.284 2.284A4.35 4.35 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.8 4.8 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.7 3.7 0 0 0 1.599-2.431H8v-3.08z"
                /></svg
              >Sign Up with Google</a
            >
          </div>

          <a href="/signup" style="color: black" class="acc"
            >Dont have an account?</a
          >
        </form>
      </div>
    </div>
    <script>
      const emailid = document.getElementById("email");
      const passid = document.getElementById("password");
      const error1 = document.getElementById("error1");
      const error2 = document.getElementById("error2");
      const loginform = document.getElementById("loginform");

      function emailValidateChecking(e) {
        const emailval = emailid.value;
        const emailpattern =
          /^[a-zA-Z0-9._-]+@([a-zA-Z0-9.-]+)\.([a-zA-Z]{2,4})$/;

        if (!emailpattern.test(emailval)) {
          error1.style.display = "block";
          error1.innerHTML = "Invalid Format";
        } else {
          error1.style.display = "none";
          error1.innerHTML = "";
        }
      }

      function passValidateChecking(e) {
        const passval = passid.value;
        if (passval.length < 8) {
          error2.style.display = "block";
          error2.innerHTML = "Should contain at least 8 characters";
        } else {
          error2.style.display = "none";
          error2.innerHTML = "";
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        loginform.addEventListener("submit", function (e) {
          emailValidateChecking();
          passValidateChecking();

          if (!emailid || !passid || !error1 || !error2 || !loginform) {
            console.error("One or more elements not found");
          }

          if (error1.innerHTML || error2.innerHTML) {
            e.preventDefault();
          }
        });
      });

      let isPasswordVisible = false;

      function togglePassword() {
        // Get references to elements
        const passwordField = document.getElementById("password");
        const passIcon = document.getElementById("pass-icon");

        if (isPasswordVisible) {
          passwordField.type = "password";
          passIcon.src = "/images/userImg/icon/closed2.png"; // Closed-eye icon
        } else {
          passwordField.type = "text";
          passIcon.src = "/images/userImg/icon/open.png"; // Open-eye icon
        }

        // Toggle state
        isPasswordVisible = !isPasswordVisible;
      }
    </script>
  </body>
</html>

<!-- product details page -->
<%-include("../../views/partials/user/header")%>
<!-- Shop Details Section Begin -->
<style>
  .nice-select {
    margin-right: 15px;
    position: relative;
    bottom: -14px;
  }
</style>
<section class="shop-details">
  <div class="product__details__pic">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="product__details__breadcrumb">
            <a href="/">Home</a>
            <a href="/shop">Shop</a>
            <span>Product Details</span>
          </div>
        </div>
      </div>
      <div class="row">
        <!-- Thumbnails -->
        <div class="col-lg-1 col-md-1">
          <ul class="nav nav-tabs">
            <% for(let i = 0; i < product.productImage.length; i++) { %>
            <li class="nav-item">
              <a
                class="nav-link thumbnail-link"
                data-image-src="/uploads/product-images/<%= product.productImage[i] %>"
                role="tab"
              >
                <div class="product__thumb__pic">
                  <img
                    src="/uploads/product-images/<%= product.productImage[i] %>"
                    alt="Product Image <%= i+1 %>"
                  />
                </div>
              </a>
            </li>
            <% } %>
          </ul>
        </div>

        <!-- Main Image Display -->
        <div class="col-lg-4 col-md-8">
          <div
            class="product__details__pic__item"
            style="position: relative; margin: 64px -6px; left: 76px"
          >
            <img
              id="main-product-image"
              src="/uploads/product-images/<%= product.productImage[0] %>"
              alt="Main Product Image"
              style="width: 100%"
            />
            <!-- Zoom Icon -->
            <div
              class="zoom-icon"
              style="
                position: absolute;
                top: 10px;
                right: 10px;
                cursor: pointer;
              "
            >
              <img
                src="/images/userImg/icon/search.png"
                alt="Zoom Icon"
                width="30"
                height="30"
                onclick="openZoomModal()"
              />
            </div>
          </div>
        </div>

        <!-- Modal for zoomed image -->
        <div
          id="zoomModal"
          class="modal"
          style="
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
          "
        >
          <span
            class="close"
            style="
              position: absolute;
              top: 10px;
              right: 20px;
              font-size: 40px;
              color: white;
              cursor: pointer;
            "
            onclick="closeZoomModal()"
            >&times;</span
          >
          <img
            id="zoomedImage"
            src="/uploads/product-images/<%= product.productImage[0] %>"
            style="max-width: 90%; max-height: 90%"
          />
        </div>
        <div class="col-lg-6 col-md-8">
          <div class="container" style="margin-left: 140px">
            <div class="row">
              <div class="col-lg-12">
                <div class="product__details__text">
                  <h4 style="text-align: left"><%= product.productName %></h4>
                  <div class="rating" style="text-align: left">
                    Product Offer : <%=product.productOffer ?
                    product.productOffer : 0%>%
                  </div>
                  <!-- <img src="/images/userImg/icon/sale.gif" alt=""> -->
                  <!-- Sale Price -->
                  <% if (product.salePrice) { %>
                  <h6
                    style="
                      text-align: left;
                      color: rgb(255, 0, 0);
                      margin-top: -8px;
                    "
                  >
                    SalePrice: <b>₹<%= product.salePrice %></b>
                    <span style="margin-left: 20px; color: rgb(71, 60, 60)">
                      Price: ₹<%= product.regularPrice %>
                    </span>
                  </h6>
                  <% } else { %>
                  <h6
                    style="
                      text-align: left;
                      color: rgb(71, 60, 60);
                      margin-top: -8px;
                    "
                  >
                    Price: ₹<%= product.regularPrice %>
                  </h6>
                  <% } %>

                  <p style="text-align: left; margin-top: 20px">
                    <%= product.description %>
                  </p>
                  <div
                    class="product__details__option"
                    style="text-align: left"
                  >
                    <div class="product__details__option__size">
                      <span>Size:</span>
                      <% if (availableSizes && availableSizes.length > 0) { %>
                      <% availableSizes.forEach(sizeObj => { %>
                      <label
                        for="<%= sizeObj.size %>"
                        class="<%= sizeObj.quantity > 0 ? '' : 'out-of-stock' %>"
                      >
                        <%= sizeObj.size %> <% if (sizeObj.quantity === 0) { %>
                        <!-- Check if the size is out of stock -->
                        (Out of Stock)
                        <input
                          type="radio"
                          id="<%= sizeObj.size %>"
                          name="size"
                          value="<%= sizeObj.size %>"
                          disabled
                        />
                        <% } else { %>
                        <input
                          type="radio"
                          id="<%= sizeObj.size %>"
                          name="size"
                          value="<%= sizeObj.size %>"
                        />
                        <% } %>
                      </label>
                      <% }) %> <% } else { %>
                      <p>No sizes available</p>
                      <% } %>
                    </div>
                  </div>

                  <% if (product.quantity < 1) { %>
                  <div class="product__details__stock">
                    <span class="out-of-stock text-danger">Out of Stock</span>
                  </div>
                  <% } else { %>

                  <div
                    class="product__details__cart__option"
                    style="text-align: left"
                  >
                    <label for="quantity">Quantity:</label>
                    <div class="quantity">
                      <select id="quantity" name="quantity">
                        <% for (let i = 1; i <= 5; i++) { %>
                        <option value="<%= i %>"><%= i %></option>
                        <% } %>
                      </select>
                    </div>
                    <a href="#" class="primary-btn" id="addToCartButton"
                      >Add to Cart</a
                    >
                  </div>
                  <% } %>

                  <div
                    class="product__details__btns__option"
                    style="text-align: left"
                  >
                    <a
                      href="javascript:void(0);"
                      onclick="addToWishlist('<%= product._id %>')"
                      style="
                        background-color: #dc3545;
                        color: white;
                        height: 42px;
                        width: 200px;
                        text-align: center;
                        padding: 12px;
                      "
                    >
                      <i class="fa fa-heart"></i> add to wishlist
                    </a>
                  </div>

                  <div
                    class="product__details__last__option"
                    style="text-align: left"
                  >
                    <!-- <img
                      src="img/shop-details/details-payment.png"
                      alt="image"
                    /> -->
                    <ul style="padding-top: 0">
                      <li><span>Categories:</span> <%= cat.name %></li>
                      <li>
                        Category Offer : <%=cat.categoryOffer ?
                        cat.categoryOffer : 0%>%
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Related Section Begin -->
<section class="related spad">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h3 class="related-title">Related Product</h3>
      </div>
    </div>
    <div class="row">
      <% relatedProducts.forEach(product => { %>
      <div class="col-lg-3 col-md-6 col-sm-6">
        <div class="product__item sale">
          <div
            class="product__item__pic set-bg"
            data-setbg="/uploads/product-images/<%= product.productImage[0] %>"
          >
            <span class="label"
              ><a
                href="/productDetails?id=<%=product._id%>"
                style="color: white"
                >For More Details</a
              ></span
            >
            <ul class="product__hover">
              <li>
                <a href="#"
                  ><img src="/images/userImg/icon/heart.png" alt=""
                /></a>
              </li>
            </ul>
          </div>
          <div class="product__item__text">
            <h6><%=product.productName%></h6>
            <a href="/addToCart/<%=product._id%>" class="add-cart"
              >+ Add To Cart</a
            >
            <div class="rating">
              <i class="fa fa-star"></i>
              <i class="fa fa-star"></i>
              <i class="fa fa-star"></i>
              <i class="fa fa-star"></i>
              <i class="fa fa-star-o"></i>
            </div>
            <h5>
              <% if (product.salePrice) { %> ₹<%= product.salePrice %> <% } else
              { %> ₹<%= product.regularPrice %> <% } %>
            </h5>

            <div class="product__color__select">
              <label for="pc-34">
                <input type="radio" id="pc-34" />
              </label>
              <label class="active black" for="pc-35">
                <input type="radio" id="pc-35" />
              </label>
              <label class="grey" for="pc-36">
                <input type="radio" id="pc-36" />
              </label>
            </div>
          </div>
        </div>
      </div>
      <% }) %>
    </div>
  </div>
</section>
<!-- Related Section End -->

<script>
  document.querySelectorAll(".thumbnail-link").forEach((item) => {
    item.addEventListener("click", function (event) {
      event.preventDefault(); // Prevent the default link behavior

      // Get the main image element
      const mainImage = document.getElementById("main-product-image");
      const zoomedImage = document.getElementById("zoomedImage"); // Get the zoomed image element

      // Get the new image source from the clicked thumbnail
      const newImageSrc = this.getAttribute("data-image-src");

      // Update the main image's src attribute
      mainImage.src = newImageSrc;

      // Update the zoomed image's src attribute
      zoomedImage.src = newImageSrc;
    });
  });

  document.addEventListener("DOMContentLoaded", function () {
    // Get the add to cart button
    var addToCartButton = document.getElementById("addToCartButton");

    // Add click event listener
    addToCartButton.addEventListener("click", function (e) {
      e.preventDefault(); // Prevent default action

      // Get selected quantity and product ID
      var quantity = parseInt(document.getElementById("quantity").value, 10);
      var productId = "<%= product._id %>"; // Ensure this is correctly rendered

      // Get the selected size
      var selectedSize = document.querySelector('input[name="size"]:checked');
      var size = selectedSize ? selectedSize.value : null; // Get size value if selected

      // Ensure a size is selected
      if (!size) {
        Swal.fire({
          title: "Error!",
          text: "Please select a size before adding to cart",
          icon: "error",
          button: "OK",
        });
        return; // Stop if no size is selected
      }

      // Send a POST request using fetch
      fetch("/addToCart", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          productId: productId,
          quantity: quantity,
          size: size,
        }),
      })
        .then((response) => response.json()) // Parse the JSON response
        .then((data) => {
          if (data.success) {
            // Show success message using SweetAlert
            Swal.fire({
              title: "Success!",
              text: "Product added to cart successfully!",
              icon: "success",
              button: "OK",
            });
          } else {
            // Show error message
            Swal.fire({
              title: "Error!",
              text: data.message || "Failed to add product to cart",
              icon: "error",
              button: "OK",
            });
          }
        })
        .catch((error) => {
          // Log the error and show an error alert
          console.error("Error:", error);
          Swal.fire({
            title: "Error!",
            text: "An unexpected error occurred",
            icon: "error",
            button: "OK",
          });
        });
    });
  });

  // Open the modal
  function openZoomModal() {
    document.getElementById("zoomModal").style.display = "flex";
  }

  // Close the modal
  function closeZoomModal() {
    document.getElementById("zoomModal").style.display = "none";
  }

  function addToWishlist(productId) {
    fetch("/addToWishlist", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ productId: productId }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          Swal.fire({
            title: "Success!",
            text: "Product added to Wishlist successfully!",
            icon: "success",
            confirmButtonText: "OK",
          });
        } else {
          Swal.fire({
            title: "Error!",
            text: data.message || "Failed to add product to Wishlist",
            icon: "error",
            confirmButtonText: "OK",
          });
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        Swal.fire({
          title: "Error!",
          text: "An unexpected error occurred",
          icon: "error",
          confirmButtonText: "OK",
        });
      });
  }
</script>

<%-include("../../views/partials/user/footer")%>

// forgotpaasswordotp
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .container {
        max-width: 100vw !important;
        height: 100vh !important;
        box-shadow: none;
        display: flex;
        justify-content: center;
        align-items: center;
        background-image: url(/images/userImg/home/img2_1.png);
        background-size: cover;
        background-position: center;
        height: 100%;
      }
      .login_wrap {
        width: 100%;
        max-width: 400px;
        padding: 20px;
        border-radius: 5px;
        background: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .heading_s1 h3 {
        margin: 0;
        font-size: 24px;
        font-weight: 600;
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .otp-timer {
        display: inline-block;
        margin-left: 10px;
        font-size: 14px;
        position: relative;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        line-height: 60px;
        text-align: center;
        background: #f2f2f2;
        border: 2px solid #ddd;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      #timerValue {
        display: block;
        font-size: 24px;
        font-weight: bold;
        color: #333;
        line-height: 60px;
      }
      #timerValue.expired {
        font-size: 14px;
        color: red;
      }
      .btn-primary {
        background-color: rgba(139, 0, 0) !important;
        border: none;
        color: white;
        height: 33px;
        width: 100%;
        margin: 21px 0;
        display: block;
      }

      .btn-secondary {
        background-color: #6c757d;
        border: none;
        color: white;
        height: 33px;
        width: 100%;
        margin: 21px 0;
        display: block;
      }
      .btn-secondary:hover {
        background-color: #5a6268;
      }
      .otp-timer {
        display: inline-block;
        margin-left: 10px;
        font-size: 14px;
        position: relative;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        line-height: 60px;
        text-align: center;
        background: #f2f2f2;
        border: 2px solid #ddd;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
      }

      #timerValue {
        font-size: 24px;
        font-weight: bold;
        color: #333;
      }

      #timerValue.expired {
        font-size: 14px;
        color: red;
      }

      .alert-danger {
        margin-top: 15px;
        text-align: center;
      }
      .text-center {
        text-align: center;
        margin-top: 15px;
      }
      .text-muted {
        color: #6c757d;
        text-align: center;
      }
      .pt-25 {
        padding-top: 25px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .login_wrap {
          max-width: 90%;
        }
        .form-group input,
        .form-group button {
          width: 100%;
        }
        .otp-timer {
          width: 50px;
          height: 50px;
          line-height: 50px;
        }
      }

      @media (max-width: 480px) {
        .heading_s1 h3 {
          font-size: 20px;
        }
        .btn-primary,
        .btn-secondary {
          width: 100%;
        }
        #otp {
          width: 100%;
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="/styles/userStyle/bootstrap.min.css"
      type="text/css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
  </head>
  <body>
    <div class="container">
      <div class="login_wrap">
        <div class="padding_eight_all bg-white">
          <div class="heading_s1">
            <h3 class="mb-30 text-center">Email Verification</h3>
          </div>
          <div class="otp-container">
            <form
              method="post"
              action="/forgot-email-valid"
              onsubmit="return validateOTPForm()"
            >
              <div class="form-group">
                <label for="otp">Enter OTP:</label>
                <input
                  type="text"
                  id="otp"
                  name="otp"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <button type="submit" class="btn btn-primary">
                  Verify OTP
                </button>
              </div>
            </form>
            <div class="text-center">
              <div id="otpTimer" class="otp-timer">
                <span id="timerValue">60</span>
              </div>
              <button
                type="button"
                class="btn btn-secondary"
                id="resendOtpBtn"
                onclick="resendOTP()"
                disabled
              >
                Resend OTP
              </button>
            </div>
            <%if(locals.message && message.length > 0){%>
            <div class="alert alert-danger mt-3"><%=message%></div>
            <%}%>
          </div>
          <div class="text-muted text-center pt-25">
            Already verified? <a href="/login">Login now</a>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      document.getElementById("otp").focus();

      let timer = 60;
      let timerInterval;

      function startTimer() {
        timerInterval = setInterval(() => {
          timer--;
          document.getElementById("timerValue").textContent = timer;
          if (timer <= 0) {
            clearInterval(timerInterval);
            document.getElementById("timerValue").classList.add("expired");
            document.getElementById("timerValue").textContent = "Expired";
            document.getElementById("otp").disabled = true;
            document.getElementById("resendOtpBtn").disabled = false;
          }
        }, 1000);
      }

      function validateOTPForm() {
        const otpInput = document.getElementById("otp").value;

        $.ajax({
          type: "POST",
          url: "/verify-forgotPassword-otp",
          data: { otp: otpInput },
          success: function (response) {
            if (response.success) {
              Swal.fire({
                icon: "success",
                title: "OTP Verified Successfully",
                showConfirmButton: false,
                timer: 1500,
              }).then(() => {
                window.location.href = response.redirectUrl;
              });
            } else {
              Swal.fire({
                icon: "error",
                title: "Invalid OTP",
                text: response.message,
              });
            }
          },
          error: function () {
            Swal.fire({
              icon: "error",
              title: "Invalid OTP",
              text: "Please try again",
            });
          },
        });

        return false;
      }

      function resendOTP() {
        clearInterval(timerInterval);
        timer = 60;
        document.getElementById("otp").disabled = false;
        document.getElementById("timerValue").classList.remove("expired");
        document.getElementById("timerValue").textContent = timer;
        document.getElementById("resendOtpBtn").disabled = true;
        startTimer();

        $.ajax({
          type: "POST",
          url: "/resend-forgot-otp",
          success: function (response) {
            if (response.success) {
              Swal.fire({
                icon: "success",
                title: "OTP Resent Successfully",
                showConfirmButton: false,
                timer: 1500,
              });
            } else {
              Swal.fire({
                icon: "error",
                title: "Error",
                text: "An error occurred while resending OTP, please try again",
              });
            }
          },
        });

        return false;
      }

      startTimer();
    </script>
  </body>
</html>

